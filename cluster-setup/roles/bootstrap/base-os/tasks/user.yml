- name: Add a workshop group
  group:
    name: workshop
    gid: "1000"

- name: Add workshop user
  user:
    name: workshop
    comment: A workshop user
    uid: "1000"
    group: "workshop"

- name: Place ssh keys for user workshop
  authorized_key:
    user: workshop
    state: present
    key: "{{ item.ssh_key }}"
    key_options: 'environment="REMOTE_USER={{ item.name }}"'
  loop: "{{ workshop.trainers |Â union(workshop.participants) }}"

- name: install sane bashrc for all users
  copy:
    src: bashrc
    dest: "{{ item.home }}/.bashrc"
    owner: "{{ item.user }}"
    group: "{{ item.group }}"
    mode: 0644
  loop:
    - { home: '/root', user: 'root', group: 'root' }
    - { home: '/home/workshop', user: 'workshop', group: 'workshop' }

- name: create payload directory
  file:
    name: "/www"
    state: directory
    owner: workshop
    group: workshop
    mode: 0755